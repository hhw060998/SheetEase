# SheetEase

轻量级、零依赖、可扩展的 Excel → JSON + C# 导出工具，专为游戏等需要高效配置管理的场景设计。

> **对比 luban**：本工具更轻量、无平台/框架依赖、易于二次开发，适合小中型项目和 Unity 工程。支持自定义类型、引用校验、GUI 批量导出，开箱即用。

---

## 功能亮点

- **一键导出**：使用批处理（需要python环境）或构建好的程序一键批量导出 JSON 与 C# 代码。
- **严格校验**：字段命名、类型、主键唯一、引用关系等全流程检查。
- **高效集成**：C# 端自动生成访问类，O(1) 查询，支持多种查询方式。
- **自定义类型**：支持“通用回退”与“专用解析器”两种模式，灵活适配业务。
- **易用 GUI**：可视化路径选择、配置保存、实时日志，适合策划/程序协作。
- **零依赖**：仅需 Python 3.x，无需第三方库，易于集成到现有项目。

---

## 目录结构

```text
ExcelExportTool/        # Python 源码
ExcelFolder/            # Excel 示例与批处理
ProjectFolder/          # C# 工程与导出示例
```

---

## 快速上手

1. **环境准备**  
  安装 Python 3.x（建议 3.10+），并配置 `ExcelFolder/!【导表】.bat`（Excel 目录、工具目录、输出目录）。

1. **Excel 规范**  
  文件名建议大写（便于过滤），Sheet 名需符合 C# 类命名规范；表头依次为：第1行字段名，第2行类型（基础/自定义），第3行注释（可选）。

1. **导出方式**  
  命令行可双击 `ExcelFolder/!【导表】.bat`；GUI 可运行 `ExcelExportTool/app_main.py`（开发环境）或打包后的 `dist/SheetEase.exe`。路径选择、配置保存、运行导表、日志查看均在 GUI 内完成。

1. **C# 集成**  
  将导出的 JSON 与 C# 文件加入项目，启动时加载即可。

---

## 数据类型与自定义类型

- 基础类型：`int`、`float`、`string/str`、`bool`
- 容器类型：`list(...)`、`dict(...)`
- **自定义类型**：
  - **通用回退**（默认）：Excel 类型行填写全限定名，单元格用 `#` 分隔，导出为 `{ "__type": ..., "segments": [...] }`，C# 端自定义解析。
  - **专用解析器**（可选）：在 `data_processing.py` 注册解析器，导出结构更语义化，C# 端可直接映射。

---

## 引用校验

- 字段名可加 `[Sheet/Field]` 前缀，自动检查引用存在性与类型一致性。
- 支持 list(T) 元素级校验，dict 类型会警告并跳过。
- 所有引用校验在导出后统一进行，错误/警告不会中断导表。

---

## 常见问题（FAQ）

- **Q: 新增自定义类型需要改 Python 吗？**
  - 不需要，通用回退已支持任意类型，仅需专用结构时注册解析器。
- **Q: C# 如何处理自定义类型？**
  - 用通用结构（`__type`+`segments`）或自定义类，业务层解释。
- **Q: 支持数组/字典嵌套自定义类型吗？**
  - 支持，list/dict 可嵌套，复杂场景可扩展解析器。
- **Q: 与 luban 有何区别？**
  - luban 功能更全、支持多语言/格式，适合大型项目；本工具更轻量、易用、零依赖，适合快速集成和定制。

---

## 示例与参考

- Excel 示例：`ExcelFolder/SL示例.xlsx`、`ExcelFolder/SL组合key示例.xlsx`
- 自动生成 C#：`ProjectFolder/ConfigData/AutoGeneratedScript/`
- JSON 示例：`ProjectFolder/Json/`

---

## 构建与打包（Windows）

推荐使用随仓库提供的脚本一键打包为独立可执行文件：

1) 安装依赖（仅需 PyInstaller）

```powershell
pip install pyinstaller
```

1) 执行打包脚本

```powershell
# 生成单文件可执行（dist/SheetEase.exe）
./build_windows.bat --onefile

# 或生成文件夹分发版（dist/SheetEase/）
./build_windows.bat
```

脚本要点：

- 打包入口：`ExcelExportTool/app_main.py`
- 可执行名：`SheetEase`
- 通过 `--collect-submodules` 与一系列 `--hidden-import` 确保子模块完整被收集
- 通过 `--add-data` 将 `ProjectFolder` 与 `ExcelExportTool` 作为运行数据打包，便于运行时接口校验/资源访问

> 注：如果你自定义了模块或资源路径，请同步调整 `build_windows.bat` 中的参数。

---

## 新版 GUI 交互说明

新版工具提供统一的主窗口，上部为路径配置与操作区，下部为实时日志区：

- 路径配置（四项）
  - Excel 根目录
  - 工程 JSON 输出目录
  - C# 脚本输出目录
  - 枚举输出目录

- 统计信息（路径下方一行提示）
  - Excel 根目录：显示“该目录将导出N张Excel表格”（规则：递归统计 .xlsx，文件名首字母大写，且不以 `~$` 开头）
  - 工程 JSON 输出目录：显示“该目录包含N个Json文件”（递归统计 .json）
  - C# 脚本输出目录：显示“该目录包含N个脚本”（递归统计 .cs）
  - 枚举输出目录：显示“该目录包含N个脚本”（递归统计 .cs）

- 操作按钮
  - 保存配置：校验路径有效性并写入根目录 `sheet_config.json`
  - 开始导出：在后台线程中执行导表，界面不卡死
  - 清空日志：清除下方日志区文本

- 自动运行导表
  - 窗口右侧“自动运行导表”勾选后：
    - 下次启动自动触发一次导出（延迟约 300ms，确保 UI 就绪）
    - 关闭窗口时会自动保存当前配置，无需手动点“保存配置”

- 日志区域
  - 黑色背景，支持 ANSI 颜色（红/绿/黄）
  - 实时滚动显示导表过程信息
  - 窗口拖拽仅改变日志区域的高度，上方配置区域保持紧凑

---

## License

本仓库代码和示例以根目录 `LICENSE` 为准。

---

## English Version

## Overview

A lightweight, dependency-free, and extensible Excel → JSON + C# exporter, designed for efficient config management in games and similar projects.

> **Compared to luban**: This tool is lighter, has no platform/framework dependencies, and is easy to extend. It is ideal for small/medium projects and Unity. Supports custom types, reference checks, and GUI batch export out of the box.

---

## Highlights

- **One-click export**: Batch or GUI export of JSON and C# code.
- **Strict validation**: Checks for field naming, types, primary key uniqueness, and references.
- **Efficient integration**: Auto-generated C# accessors, O(1) queries, multiple query helpers.
- **Custom types**: Supports both generic fallback and dedicated parser modes.
- **User-friendly GUI**: Visual path selection, config saving, real-time logs.
- **Zero dependencies**: Only needs Python 3.x, no third-party libraries.

---

## Structure

```text
ExcelExportTool/        # Python source
ExcelFolder/            # Excel samples and batch
ProjectFolder/          # C# project and export samples
```

---

## Quick Start

1. **Requirements**  
  Python 3.x (3.10+ recommended). Edit `ExcelFolder/!【导表】.bat` to set Excel, tool, and output directories.

1. **Excel Convention**  
  File name: UPPERCASE recommended; sheet name should follow C# class naming. Header: row 1 field names, row 2 types (basic/custom), row 3 comments (optional).

1. **Export**  
  CLI: Double-click `ExcelFolder/!【导表】.bat`. GUI: Run `ExcelExportTool/app_main.py` in dev or use packaged `dist/SheetEase.exe`. All path selection, config, export, and logs are in the GUI.

1. **C# Integration**  
  Add exported JSON and C# to your project and load them at startup.

---

## Data Types & Custom Types

- Basic: `int`, `float`, `string/str`, `bool`
- Containers: `list(...)`, `dict(...)`
- **Custom types**:
  - **Generic fallback** (default): Type row is fully qualified, cell uses `#` to split, exports as `{ "__type": ..., "segments": [...] }`, parse in C# as needed.
  - **Dedicated parser** (optional): Register in `data_processing.py` for semantic JSON, map directly in C#.

---

## Reference Checks

- Field names can have `[Sheet/Field]` prefix for auto existence/type checks.
- Supports list(T) element checks; dict fields are warned and skipped.
- All checks run after export; errors/warnings do not stop export.

---

## FAQ

- **Q: Do I need to modify Python for new custom types?**
  - No, generic fallback supports any type; only register a parser for special structure.
- **Q: How to handle custom types in C#?**
  - Use the generic structure (`__type`+`segments`) or a custom class, interpret in business logic.
- **Q: Are arrays/dicts of custom types supported?**
  - Yes, list/dict can nest custom types; extend parser for complex cases.
- **Q: How is this different from luban?**
  - luban is more feature-rich and supports more formats/languages for large projects; this tool is lighter, easier, and dependency-free for quick integration and customization.

---

## Examples

- Excel: `ExcelFolder/SL示例.xlsx`, `ExcelFolder/SL组合key示例.xlsx`
- C#: `ProjectFolder/ConfigData/AutoGeneratedScript/`
- JSON: `ProjectFolder/Json/`

---

## Build & Package (Windows)

Use the provided script to build a standalone executable:

1) Install dependency

```powershell
pip install pyinstaller
```

1) Build

```powershell
# Single-file executable (dist/SheetEase.exe)
./build_windows.bat --onefile

# Or directory-based distribution (dist/SheetEase/)
./build_windows.bat
```

Notes:

- Entry: `ExcelExportTool/app_main.py`
- Name: `SheetEase`
- Uses `--collect-submodules` and `--hidden-import` to bundle all submodules
- Includes `ProjectFolder` and `ExcelExportTool` as runtime data via `--add-data`

---

## New GUI Interactions

Unified main window with path config on top and logs below:

- Paths (4 fields): Excel root, JSON output, C# scripts output, Enum output
- Under each path field, a count line shows:
  - Excel root: “Export N Excel files” (recursively count .xlsx with uppercase first letter, excluding `~$` temp files)
  - JSON output: “Contains N Json files” (recursively count .json)
  - C# scripts output: “Contains N scripts” (recursively count .cs)
  - Enum output: “Contains N scripts” (recursively count .cs)
- Buttons: Save Config (validate & write `sheet_config.json`), Start Export (runs in background), Clear Log
- Auto Run: when checked, auto-start export on next launch and auto-save config on window close
- Logs: black background with ANSI colors; only the log area resizes vertically when resizing the window

See `LICENSE` at the repository root.
